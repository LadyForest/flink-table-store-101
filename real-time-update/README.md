# Real-time update Demo

## Get Started
- Start MySQL
    ```bash
    docker-compose build --no-cache && docker-compose up -d --force-recreate
    ```
    The started container will init MySQL database `tpch_s1` with `lineitem.tbl` generated by TPC-H dbgen with default scale factor (1) into `tpch_s1`.`lineitem`. 
    - Note: the scale factor can be changed by changing args `sf` in the docker-compose.yml, and the database name suffix will change accordingly. *E.g.*, with `sf` set to `10`, the database name is set to `tpch_s10`.
    - Note: `--no-cache` is required since the image needs a fresh build.
    
    Use `docker logs -f ${container-id}` to track the import progress. 
    Once you saw the following log, the import process is finished.
    ```plaintext
    [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.30'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server - GPL.
    ```

- Preview data
    ```bash
    docker exec -it ${container-id} bash
    ```
    This command will let you enter into the container. From within
    ```bash
    mysql -uflink -pflink
    ```
    execute
    ```sql
    USE tpch_s1;
    SHOW tables;
    SELECT * FROM lineitem LIMIT 10;
    ```
    - Note: you can also use local mysql client connect to the dockerized MySQL.
        ```bash
        # from your host machine, run
        mysql -uflink -pflink -h127.0.0.1 -P3307
        
        # if you prefer using a hostname
        # you can add 127.0.0.1 mysql.docker.internal
        # to your host machine, and then run
        mysql -uflink -pflink -hmysql.docker.internal -P3307
        ```

- Generate updates
    - upsert
        ```bash
        docker exec -i ${container-id} /bin/bash -c "export STAGE=update && export UPDATE_TYPE=upsert && export FILE_NAME=lineitem.tbl.u1 && transaction-commit.sh
        ```
    - delete
        ```bash
        docker exec -i ${container-id} /bin/bash -c "export STAGE=update && export UPDATE_TYPE=delete && export FILE_NAME=delete.1 && transaction-commit.sh
        ```    
    Each run of will affect 10% rows of `lineitem`

- Stop and cleanup
    ```bash
    docker-compose down && docker rmi real-time-update_mysql-101 && docker volume prune && docker system prune
    ```